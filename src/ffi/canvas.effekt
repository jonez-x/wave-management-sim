module src/ffi/canvas

// ============================================================
// Canvas FFI Bindings for HTML5 Canvas API
// ============================================================

// External JavaScript code block
extern js """
  let $canvas = null;
  let $ctx = null;
  
  function $initCanvas(id, width, height) {
    $canvas = document.getElementById(id);
    if (!$canvas) {
      $canvas = document.createElement('canvas');
      $canvas.id = id;
      document.body.appendChild($canvas);
    }
    $canvas.width = width;
    $canvas.height = height;
    $ctx = $canvas.getContext('2d');
    return $ctx !== null;
  }
  
  function $clearCanvas() {
    if ($ctx && $canvas) {
      $ctx.clearRect(0, 0, $canvas.width, $canvas.height);
    }
  }
  
  function $setFillColor(r, g, b, a) {
    if ($ctx) $ctx.fillStyle = 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';
  }
  
  function $setStrokeColor(r, g, b, a) {
    if ($ctx) $ctx.strokeStyle = 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';
  }
  
  function $fillRect(x, y, w, h) {
    if ($ctx) $ctx.fillRect(x, y, w, h);
  }
  
  function $strokeRect(x, y, w, h) {
    if ($ctx) $ctx.strokeRect(x, y, w, h);
  }
  
  function $fillCircle(x, y, radius) {
    if ($ctx) {
      $ctx.beginPath();
      $ctx.arc(x, y, radius, 0, Math.PI * 2);
      $ctx.fill();
    }
  }
  
  function $strokeCircle(x, y, radius) {
    if ($ctx) {
      $ctx.beginPath();
      $ctx.arc(x, y, radius, 0, Math.PI * 2);
      $ctx.stroke();
    }
  }
  
  function $drawLine(x1, y1, x2, y2) {
    if ($ctx) {
      $ctx.beginPath();
      $ctx.moveTo(x1, y1);
      $ctx.lineTo(x2, y2);
      $ctx.stroke();
    }
  }
  
  function $setLineWidth(width) {
    if ($ctx) $ctx.lineWidth = width;
  }
  
  function $fillText(text, x, y) {
    if ($ctx) $ctx.fillText(text, x, y);
  }
  
  function $setFont(font) {
    if ($ctx) $ctx.font = font;
  }
  
  function $setTextAlign(align) {
    if ($ctx) $ctx.textAlign = align;
  }
  
  function $getCanvasWidth() {
    return $canvas ? $canvas.width : 0;
  }
  
  function $getCanvasHeight() {
    return $canvas ? $canvas.height : 0;
  }
"""

// Initialize the canvas with given ID and dimensions
extern def initCanvas(id: String, width: Int, height: Int): Bool =
  js "$initCanvas(${id}, ${width}, ${height})"

// Clear the entire canvas
extern def clearCanvas(): Unit =
  js "$clearCanvas()"

// Set fill color (RGBA)
extern def setFillColor(r: Int, g: Int, b: Int, a: Double): Unit =
  js "$setFillColor(${r}, ${g}, ${b}, ${a})"

// Set stroke color (RGBA)
extern def setStrokeColor(r: Int, g: Int, b: Int, a: Double): Unit =
  js "$setStrokeColor(${r}, ${g}, ${b}, ${a})"

// Draw a filled rectangle
extern def fillRect(x: Double, y: Double, w: Double, h: Double): Unit =
  js "$fillRect(${x}, ${y}, ${w}, ${h})"

// Draw a stroked rectangle
extern def strokeRect(x: Double, y: Double, w: Double, h: Double): Unit =
  js "$strokeRect(${x}, ${y}, ${w}, ${h})"

// Draw a filled circle
extern def fillCircle(x: Double, y: Double, radius: Double): Unit =
  js "$fillCircle(${x}, ${y}, ${radius})"

// Draw a stroked circle
extern def strokeCircle(x: Double, y: Double, radius: Double): Unit =
  js "$strokeCircle(${x}, ${y}, ${radius})"

// Draw a line between two points
extern def drawLine(x1: Double, y1: Double, x2: Double, y2: Double): Unit =
  js "$drawLine(${x1}, ${y1}, ${x2}, ${y2})"

// Set the line width for strokes
extern def setLineWidth(width: Double): Unit =
  js "$setLineWidth(${width})"

// Draw text at position
extern def fillText(text: String, x: Double, y: Double): Unit =
  js "$fillText(${text}, ${x}, ${y})"

// Set the font for text drawing
extern def setFont(font: String): Unit =
  js "$setFont(${font})"

// Set text alignment ("left", "center", "right")
extern def setTextAlign(align: String): Unit =
  js "$setTextAlign(${align})"

// Get canvas dimensions
extern def getCanvasWidth(): Int =
  js "$getCanvasWidth()"

extern def getCanvasHeight(): Int =
  js "$getCanvasHeight()"
